<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>F1Ya · Apple Style</title>

  <style>
    :root {
      --bg:#0a0a0a;
      --panel:#111111;
      --panel-soft:#161616;
      --text:#f5f5f7;
      --muted:#9b9b9f;
      --accent:#ff2d2d;
      --border:#1f1f1f;
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      background:linear-gradient(180deg,#000 0%,var(--bg) 100%);
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,system-ui,sans-serif;
    }
    header{
      position:sticky;top:0;z-index:50;
      background:rgba(10,10,10,.7);
      backdrop-filter:blur(20px);
      border-bottom:1px solid var(--border);
    }
    .header-inner{
      max-width:1600px;margin:0 auto;
      padding:14px 20px;
      display:flex;align-items:center;gap:20px;
    }
    .logo{font-size:20px;font-weight:600}
    .logo span{color:var(--accent)}
    .tabs{margin-left:auto;display:flex;gap:10px}
    .tab{
      padding:8px 18px;border-radius:999px;
      border:1px solid var(--border);
      background:transparent;color:var(--muted);
      cursor:pointer;
    }
    .tab.active{background:var(--accent);color:#fff;border-color:transparent}
    main{
      max-width:1600px;margin:0 auto;
      padding:28px 20px 40px;
      display:grid;grid-template-columns:1fr 400px;gap:28px;
    }
    .player-card,.chat-card{
      background:var(--panel);
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow:0 30px 80px rgba(0,0,0,.5);
    }
    .player-top,.chat-top{
      padding:14px 18px;
      border-bottom:1px solid var(--border);
      font-size:14px;
    }
    .player-wrap{aspect-ratio:16/9;background:#000}
    iframe{width:100%;height:100%;border:0}
    .chat-card{display:flex;flex-direction:column}
    .chat-messages{
      flex:1;padding:12px;overflow-y:auto;
      font-size:13px;overflow-wrap:anywhere;
    }
    .msg{margin-bottom:8px}
    .chat-input{
      display:flex;gap:8px;padding:10px;
      border-top:1px solid var(--border);
      align-items:center;
    }
    .chat-input input{
      background:var(--panel-soft);
      border:1px solid var(--border);
      border-radius:999px;
      padding:8px 12px;
      color:var(--text);
      font-size:13px;
      outline:none;flex:1;
    }
    #nick{width:90px;opacity:.7;cursor:not-allowed}
    .chat-input button{
      padding:8px 14px;border-radius:999px;
      border:none;background:var(--accent);
      color:#fff;cursor:pointer;
    }
    .auth-buttons{
      display:flex;gap:8px;padding:10px;
      border-top:1px solid var(--border);
      flex-wrap:wrap;
    }
    .auth-buttons button, .auth-buttons input[type=color]{
      flex:1;background:transparent;
      border:1px solid var(--border);
      color:var(--muted);
      border-radius:999px;padding:6px;
      cursor:pointer;
    }
    .auth-buttons input[type=color]{
      padding:0; border:none; height:32px;
    }
    @media(max-width:1100px){main{grid-template-columns:1fr}}
  </style>
</head>

<body>

<header>
  <div class="header-inner">
    <div class="logo">F1<span>Ya</span></div>
    <div class="tabs">
      <button class="tab active" id="btn-daddy" onclick="cambiarStream('daddy')">DAZN F1</button>
      <button class="tab" id="btn-espn" onclick="cambiarStream('espn')">ESPN</button>
      <button class="tab" id="btn-fox" onclick="cambiarStream('fox')">FOX</button>
    </div>
  </div>
</header>

<main>
  <section class="player-card">
    <div class="player-top"><strong>Fórmula 1 · Live</strong></div>
    <div class="player-wrap">
      <iframe id="player" src="about:blank" allowfullscreen></iframe>
    </div>
  </section>

  <aside class="chat-card">
    <div class="chat-top"><strong>Chat en vivo</strong></div>
    <div class="chat-messages" id="messages"></div>

    <div class="chat-input">
      <input id="nick" disabled>
      <input id="text" placeholder="Mensaje…">
      <button onclick="sendMsg()">Enviar</button>
    </div>

    <div class="auth-buttons">
      <button id="btn-register" onclick="register()">Registrarse</button>
      <button id="btn-login" onclick="login()">Login</button>
      <button id="btn-logout" onclick="logout()" style="display:none">Logout</button>
      <button id="btn-edit-color" onclick="showColorPicker()" style="display:none">Editar</button>
      <input type="color" id="color-picker" style="display:none">
    </div>
  </aside>
</main>

<script type="module">
  /* STREAMS */
  const streams={
    daddy:"aHR0cHM6Ly9kYWRkeWhkLmNvbS93YXRjaC9zdHJlYW0tNTM3LnBocA==",
    espn:"aHR0cHM6Ly9kYWRkeWhkLmNvbS9zdHJlYW0vc3RyZWFtLTE0OS5waHA=",
    fox:"aHR0cHM6Ly9kYWRkeWhkLmNvbS9zdHJlYW0vc3RyZWFtLTc4Ny5waHA="
  };
  const player=document.getElementById('player');
  window.cambiarStream=t=>{
    player.src=atob(streams[t]);
    ['daddy','espn','fox'].forEach(k=>{
      document.getElementById('btn-'+k).classList.toggle('active',k===t);
    });
  };
  cambiarStream('daddy');

  /* FIREBASE */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded, set, get }
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const app=initializeApp({
    apiKey:"AIzaSyDSxZILNH92QqkfnQeSpYZeboqylAo_6S0",
    authDomain:"sushitime-b84fc.firebaseapp.com",
    databaseURL:"https://sushitime-b84fc-default-rtdb.firebaseio.com",
    projectId:"sushitime-b84fc"
  });

  const db=getDatabase(app);
  const auth=getAuth(app);

  signOut(auth);

  const messagesRef=ref(db,'chat/messages');
  const box=document.getElementById('messages');
  const nickInput=document.getElementById('nick');
  const textInput=document.getElementById('text');

  const btnLogin=document.getElementById('btn-login');
  const btnRegister=document.getElementById('btn-register');
  const btnLogout=document.getElementById('btn-logout');
  const btnEditColor=document.getElementById('btn-edit-color');
  const colorPicker=document.getElementById('color-picker');

  const guestNick='Guest'+Math.random().toString(36).substring(2,6).toUpperCase();
  let currentNick=guestNick;
  let currentColor="#ffffff";
  nickInput.value=guestNick;

  onAuthStateChanged(auth, async user=>{
    if(user){
      const snap=await get(ref(db,'users/'+user.uid+'/nick'));
      currentNick=snap.val();

      const colorSnap = await get(ref(db,'users/'+user.uid+'/color'));
      currentColor = colorSnap.val() || "#ffffff";

      nickInput.value=currentNick;

      btnLogin.style.display='none';
      btnRegister.style.display='none';
      btnLogout.style.display='block';
      btnEditColor.style.display='block';
    }else{
      currentNick=guestNick;
      currentColor="#ffffff";
      nickInput.value=guestNick;

      btnLogin.style.display='block';
      btnRegister.style.display='block';
      btnLogout.style.display='none';
      btnEditColor.style.display='none';
      colorPicker.style.display='none';
    }
  });

  onChildAdded(messagesRef,snap=>{
    const m=snap.val();
    const badge = m.verified ? ' <span style="color:#2ecc71">✔️</span>' : '';
    const nickColor = m.color || "#ffffff";
    const div=document.createElement('div');
    div.className='msg';
    div.innerHTML=`<strong style="color:${nickColor}">${m.nick}${badge}</strong>: ${m.text}`;
    box.appendChild(div);
    box.scrollTop=box.scrollHeight;
  });

  window.sendMsg=()=>{
    if(!textInput.value.trim())return;
    push(messagesRef,{
      nick:currentNick,
      text:textInput.value,
      verified: !!auth.currentUser,
      color: currentColor,
      time:Date.now()
    });
    textInput.value='';
  };

  window.register=async()=>{
    const nick=prompt('Nick');
    const pass=prompt('Contraseña (mínimo 6)');
    if(!nick||!pass)return;
    const email=`${nick}@chat.f1ya.com`;
    const { user }=await createUserWithEmailAndPassword(auth,email,pass);
    await set(ref(db,'users/'+user.uid),{nick,color:"#ffffff"});
  };

  window.login=async()=>{
    const nick=prompt('Nick');
    const pass=prompt('Contraseña');
    if(!nick||!pass)return;
    const email=`${nick}@chat.f1ya.com`;
    await signInWithEmailAndPassword(auth,email,pass);
  };

  window.logout=async()=>{
    await signOut(auth);
  };

  window.showColorPicker=()=>{
    colorPicker.value=currentColor;
    colorPicker.click();
  };

  colorPicker.addEventListener('input', async (e)=>{
    currentColor=e.target.value;
    const user = auth.currentUser;
    if(user){
      await set(ref(db,'users/'+user.uid+'/color'), currentColor);
    }
  });

  // ENTER key para enviar mensaje
  textInput.addEventListener('keydown', e => {
    if(e.key === 'Enter') sendMsg();
  });
</script>

</body>
</html>
